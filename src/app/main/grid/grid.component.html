<common-template
    [entity]="entity"
    [disable_activation_button]="disable_activation_button"
    [disable_delete_button]="disable_delete_button"
    [disable_edit_button]="disable_edit_button"
    [disable_view_button]="disable_view_button"
    [disable_gallery_controls]="disable_gallery_controls"
    (viewEvent)="view($event)"
    (edit_formEvent)="edit_form($event)"
    (deleteEvent)="delete($event)"
    (view_galleryEvent)="view_gallery($event)"
    (view_injectorEvent)="view_injector($event)"
    (toggle_activeEvent)="toggle_active($event)"
    (toggle_collectionEvent)="toggle_collection($event)"
>

</common-template>

<mat-sidenav-container>

    <div id="ngx-datatable" class="page-layout simple fullwidth">
        <!-- HEADER -->
        <div class="header p-16 p-md-24 accent" fxLayout="column">
            <div class="header-content" fxLayout="row wrap" fxLayoutAlign="space-between" fxFlex="1 0 auto">
                <!-- BOARD SELECTION BUTTON -->
                <div fxLayout="row" fxLayoutAlign="start center" *ngIf="!disable_add_button">
                    <button class="hidden-lt-md" mat-raised-button (click)="edit_form(null)" color="fuse-white" matTooltip="Добавить запись">Добавить запись
                    </button>
                    <button class="hidden-gt-sm" mat-mini-fab (click)="edit_form(null)" color="fuse-white" matTooltip="Добавить запись">
                        <mat-icon>add</mat-icon>
                    </button>
                </div>
                <!-- / BOARD SELECTION BUTTON -->
                <!-- SEARCH -->
                <div class="ml-sm-32 header__search-row" fxLayout="row" fxLayoutAlign="center center" fxFlex>
                    <div class="search-wrapper mt-sm-0" *ngIf="!disable_wild_search">
                        <div class="search" fxFlex fxLayout="row" fxLayoutAlign="start center">
                            <mat-icon color="primary">search</mat-icon>
                            <input [formControl]="searchInput" matTooltip="Выполняет поиск по текстовым полям" placeholder="Поиск по слову">
                            <mat-icon *ngIf="searchInput.value !== ''" class="search__clear" color="primary" matSuffix (click)="clear_search_text()">close</mat-icon>
                        </div>
                    </div>
                </div>
                <!-- / SEARCH -->
                <!-- TOOLBAR -->
                <div class="toolbar" fxLayout="row" fxLayoutAlign="space-between center" fxFlexOrder="3">
                    <mat-form-field class="pt-12 pr-8 toolbar__daterange" *ngIf="date_range_enable">
                        <input autocomplete="off"
                               matTooltip="Выбрать период времени для отображения записей"
                               matInput
                               type="text"
                               ngxDaterangepickerMd
                               [ranges]="ranges"
                               opens="left"
                               [locale]="date_range_locale"
                               (change)="date_range_change($event, date_range_key)"
                               alwaysShowCalendars="true"
                               [(ngModel)]="selected_date_filter"
                               class="date-range-control"/>
                        <mat-icon *ngIf="!selected_date_filter_has_values; else clearDatepicker" matSuffix>calendar_today</mat-icon>
                        <ng-template #clearDatepicker>
                            <mat-icon class="toolbar__daterange-clear" color="white" matSuffix (click)="clear_selected_date_filter(date_range_key)">close
                            </mat-icon>
                        </ng-template>
                    </mat-form-field>
                    <!--                    <button *ngIf="selected_date_filter_has_values" mat-icon-button matTooltip="Очистить фильтр по дате"-->
                    <!--                            (click)="clear_selected_date_filter(date_range_key)">-->
                    <!--                        <mat-icon color="white" matSuffix (click)="clear_selected_date_filter(date_range_key)">close</mat-icon>-->
                    <!--                    </button>-->

                    <button mat-icon-button (click)="refresh()" matTooltip="Обновить таблицу" class="mb-4">
                        <mat-icon>autorenew</mat-icon>
                    </button>

                    <!-- SETTINGS BUTTON -->
                    <button *ngIf="!freeze_default_columns_list" mat-icon-button (click)="settingsSidenav.toggle()"
                            aria-label="Настройки таблицы" matTooltip="Настройки таблицы" class="mb-4">
                        <mat-icon>settings</mat-icon>
                    </button>
                    <!-- / SETTINGS BUTTON -->

                    <!-- PDF BUTTON -->
                    <button *ngIf="only_collections && this.modelService.getConfigValue('apps.pdfreport.enable_api_client_report') == 1" mat-icon-button (click)="export_collections_pdf('client')"
                            aria-label="Скачать клиентский PDF" matTooltip="Скачать клиентский PDF" class="mb-4">
                        <mat-icon>picture_as_pdf</mat-icon>
                    </button>
                    <!-- / PDF BUTTON -->

                    <!-- PDF BUTTON -->
                    <button *ngIf="only_collections && this.modelService.getConfigValue('apps.pdfreport.enable_api_staff_report') == 1" mat-icon-button (click)="export_collections_pdf('staff')"
                            aria-label="Скачать PDF для сотрудников" matTooltip="Скачать PDF для сотрудников" class="mb-4">
                        <mat-icon>print</mat-icon>
                    </button>
                    <!-- / PDF BUTTON -->


                </div>
                <!-- / TOOLBAR -->
            </div>
        </div>
        <!-- / HEADER -->
        <!-- CONTENT -->
        <div class="content" layout="row">
            <!-- WIDGET GROUP -->
            <div class="widget-group grey-100-bg" fxLayout="row wrap" fxFlex="100" *fuseIfOnDom
                 [@animateStagger]="{value:'50'}">
                <!-- WIDGET 11 -->
                <fuse-widget [@animate]="{value:'*',params:{y:'100%'}}" class="widget" fxLayout="row"
                             fxFlex="100">
                    <!-- Front -->
                    <div class="fuse-widget-front mat-white-bg mat-elevation-z2">

                        <div class="message-box error" *ngIf="error">
                            {{error_message}}
                        </div>
                        <ngx-datatable
                            *ngIf="compose_complete"
                            class="material"
                            [rows]="rows_data"
                            [columns]="data_columns"
                            [loadingIndicator]="loadingIndicator"
                            [columnMode]="'force'"
                            [headerHeight]="ngxHeaderHeight"
                            [footerHeight]="56"
                            [rowHeight]="'auto'"
                            [scrollbarH]="true"
                            [reorderable]="reorderable"
                            [externalPaging]="true"
                            [count]="page.totalElements"
                            [offset]="page.pageNumber"
                            [limit]="page.size"
                            [messages]="{emptyMessage:'Ничего не найдено',totalMessage :'всего',selectedMessage :'выбрано'}"
                            [selectionType]="selectionType"
                            [rowClass]="getRowClass"
                            (activate)="onActivate($event)"
                            (resize)="onResize($event)"
                            (page)="setPage($event)"
                            (select)="onSelect($event)"
                        >
                        </ngx-datatable>
                    </div>
                    <!-- / Front -->
                </fuse-widget>
                <!-- / WIDGET 11 -->
            </div>
            <!-- / WIDGET GROUP -->
        </div>


    </div>

    <mat-sidenav #settingsSidenav position="end">
        <grid-settings [entity]="entity" [grid_items]="grid_columns_for_compose" [page]="page" *ngIf="compose_complete" (close)="settingsSidenav.close()"></grid-settings>
    </mat-sidenav>
</mat-sidenav-container>
