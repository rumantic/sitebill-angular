<div id="course-dialog" class="dialog-content-wrapper">
    <mat-toolbar>
        <mat-toolbar-row fxFlex fxLayout="row" fxLayoutAlign="space-between center">
            <span class="title dialog-title"></span>
            <button mat-icon-button (click)="close()" aria-label="Закрыть">
                <mat-icon>close</mat-icon>
            </button>
        </mat-toolbar-row>
    </mat-toolbar>

    <!--h2 mat-dialog-title>Объект</h2-->
    <div mat-dialog-content class="p-24 m-0">

        <div fxFlex="50"  fusePerfectScrollbar>
            <form class="example-container" [formGroup]="form" (ngSubmit)="save()">
                <ng-template #loggedOut>
                    <mat-spinner></mat-spinner>
                </ng-template>

                <div *ngIf="rows; else loggedOut">
                    <mat-tab-group dynamicHeight *ngIf="tabs_keys && form_inited">

                        <mat-tab *ngFor="let tab of tabs_keys" label="{{tab}}">

                            <table class="simple clickable">
                                <tbody>
                                <tr *ngFor="let x of tabs[tab]">
                                    <td class="primary-50-bg">{{records[x].title}}</td>
                                    <td class="text-right">
                                        <ng-container *ngIf="records[x].value_string != ''">{{records[x].value_string}}</ng-container>
                                        <ng-container *ngIf="records[x].value_string == ''">
                                            <ng-container [ngSwitch]="records[x].type">
                                                <ng-container *ngSwitchCase="'checkbox'">
                                                    <mat-icon *ngIf="records[x].value == 1" class="active-icon green-600 s-16">check</mat-icon>
                                                    <mat-icon *ngIf="records[x].value == 0" class="active-icon red-500 s-16">close</mat-icon>
                                                </ng-container>

                                                <ng-container *ngSwitchCase="'uploads'">
                                                    <gallery-component *ngIf="galleryImages[records[x].name].length > 0" [galleryImages]="galleryImages" [entity]="_data" [image_field]="records[x].name"></gallery-component>

                                                </ng-container>

                                                <ng-container *ngSwitchDefault>
                                                    {{records[x].value}}
                                                </ng-container>
                                            </ng-container>


                                        </ng-container>
                                    </td>
                                </tr>
                                </tbody>
                            </table>

                        <span *ngFor="let x of tabs[tab]">


                            <span [ngSwitch]="records[x].type">
                                <input *ngSwitchCase="'hidden'" [hidden]="true" readonly matInput
                                       formControlName="{{records[x].name}}" placeholder="{{records[x].title}}">

                                <mat-form-field *ngSwitchCase="'primary_key'" [hidden]="records[x].hidden">
                                    <input class="disabled-text" readonly matInput formControlName="{{records[x].name}}"
                                           placeholder="{{records[x].title}}">
                                </mat-form-field>

                                <mat-form-field *ngSwitchCase="'date'" [hidden]="records[x].hidden">
                                    <input matInput  formControlName="{{records[x].name}}"
                                           [required]="records[x].required_boolean" (click)="dp.open()"
                                           [matDatepicker]="dp" placeholder="{{records[x].title}}">
                                    <mat-datepicker-toggle matSuffix [for]="dp"></mat-datepicker-toggle>
                                    <mat-datepicker #dp
                                                    panelClass="example-month-picker">
                                    </mat-datepicker>
                                </mat-form-field>

                                <mat-form-field *ngSwitchCase="'dttime'" [hidden]="records[x].hidden">
                                    <input matInput formControlName="{{records[x].name}}"
                                           [required]="records[x].required_boolean" [ngxTimepicker]="picker"
                                           [format]="24" placeholder="{{records[x].title}}">
                                    <mat-icon matSuffix>access_time</mat-icon>
                                    <ngx-material-timepicker #picker></ngx-material-timepicker>
                                </mat-form-field>

                                <mat-form-field *ngSwitchCase="'dtdatetime'" [hidden]="records[x].hidden">
                                    <input matInput formControlName="{{records[x].name}}"
                                           [required]="records[x].required_boolean" (click)="dp.open()"
                                           [matDatepicker]="dp" placeholder="{{records[x].title}}">
                                    <mat-datepicker-toggle matSuffix [for]="dp"></mat-datepicker-toggle>
                                    <mat-datepicker #dp
                                                    panelClass="example-month-picker">
                                    </mat-datepicker>
                                </mat-form-field>

                                <mat-form-field *ngSwitchCase="'dtdate'" [hidden]="records[x].hidden">
                                    <input matInput formControlName="{{records[x].name}}"
                                           [required]="records[x].required_boolean" (click)="dp.open()"
                                           [matDatepicker]="dp" placeholder="{{records[x].title}}">
                                    <mat-datepicker-toggle matSuffix [for]="dp"></mat-datepicker-toggle>
                                    <mat-datepicker #dp
                                                    panelClass="example-month-picker">
                                    </mat-datepicker>
                                </mat-form-field>

                                <uploader-component [hidden]="records[x].hidden" *ngSwitchCase="'uploads'"
                                                    [galleryImages]="galleryImages" [entity]="_data"
                                                    [image_field]="records[x].name"></uploader-component>

                                <uploader-component [hidden]="records[x].hidden" *ngSwitchCase="'photo'"
                                                    [galleryImages]="galleryImages" [entity]="_data"
                                                    [image_field]="records[x].name"
                                                    [max_uploads]="1"></uploader-component>

                                <span *ngSwitchCase="'select_box_structure'" [hidden]="records[x].hidden">
                                    <ng-select formControlName="{{records[x].name}}"
                                               [required]="records[x].required_boolean"
                                               appendTo="body"
                                               bindValue="id"
                                               bindLabel="name"
                                               [items]="options_storage[records[x].name]"
                                               [clearOnBackspace]="false"
                                               [searchable]="true"
                                               [multiple]="false"
                                               [hideSelected]="false"
                                               (change)="apply_topic_activity()"
                                               [closeOnSelect]="true"
                                               placeholder="{{records[x].title}}">
                                        <ng-template ng-label-tmp let-item="item" let-index="index">
                                            <span [innerHTML]="item.breadcrumbs">
                                            </span>
                                        </ng-template>

                                        <ng-template ng-option-tmp let-item="item" let-index="index">

                                            <span [innerHTML]="item.name" class="level{{item.level}}">
                                            </span>
                                        </ng-template>
                                    </ng-select>
                                    <mat-error
                                        *ngIf="form.controls[records[x].name].status == 'INVALID' && form_submitted">{{records[x].title}}
                                        обязательное поле!</mat-error>
                                </span>


                                <span *ngSwitchCase="'select_by_query'" [hidden]="records[x].hidden">
                                    <ng-select formControlName="{{records[x].name}}"
                                               [required]="records[x].required_boolean"
                                               appendTo="body"
                                               bindValue="id"
                                               bindLabel="value"
                                               [items]="options_storage[records[x].name]"
                                               [clearOnBackspace]="false"
                                               [searchable]="true"
                                               [multiple]="false"
                                               [hideSelected]="false"
                                               [closeOnSelect]="true"
                                               placeholder="{{records[x].title}}">
                                        <ng-template ng-label-tmp let-item="item" let-index="index">
                                            <span [innerHTML]="item.value">
                                            </span>
                                        </ng-template>

                                        <ng-template ng-option-tmp let-item="item" let-index="index">
                                            <span [innerHTML]="item.value">
                                            </span>
                                        </ng-template>
                                    </ng-select>
                                    <mat-error
                                        *ngIf="form.controls[records[x].name].status == 'INVALID' && form_submitted">{{records[x].title}}
                                        обязательное поле!</mat-error>
                                </span>

                                <span *ngSwitchCase="'select_box'" [hidden]="records[x].hidden">
                                    <ng-select formControlName="{{records[x].name}}"
                                               [required]="records[x].required_boolean"
                                               appendTo="body"
                                               bindValue="id"
                                               bindLabel="value"
                                               [items]="options_storage[records[x].name]"
                                               [clearOnBackspace]="false"
                                               [searchable]="false"
                                               [multiple]="false"
                                               [hideSelected]="false"
                                               [closeOnSelect]="true"
                                               placeholder="{{records[x].title}}">
                                        <ng-template ng-label-tmp let-item="item">
                                            <span [innerHTML]="item.value">
                                            </span>
                                        </ng-template>

                                        <ng-template ng-option-tmp let-item="item" let-index="index">
                                            <span [innerHTML]="item.value">
                                            </span>
                                        </ng-template>
                                    </ng-select>
                                    <mat-error
                                        *ngIf="form.controls[records[x].name].status == 'INVALID' && form_submitted">{{records[x].title}}
                                        обязательное поле!</mat-error>
                                </span>


                                <mat-checkbox [hidden]="records[x].hidden" *ngSwitchCase="'checkbox'"
                                              class="form-checkbox" [required]="records[x].required_boolean" matInput
                                              formControlName="{{records[x].name}}">{{records[x].title}}</mat-checkbox>

                                <mat-form-field [hidden]="records[x].hidden" *ngSwitchCase="'textarea_editor'">
                                    <quill-editor [(ngModel)]="text_area_editor_storage[records[x].name]"
                                                  [modules]="quillConfig"
                                                  [ngModelOptions]="{standalone: true}"></quill-editor>
                                    <input formControlName="{{records[x].name}}" matInput [hidden]="true">
                                    <mat-error>{{records[x].title}} обязательное поле!</mat-error>
                                </mat-form-field>
                                <span [hidden]="records[x].hidden" *ngSwitchCase="'geodata'">

                                    <div fxLayout="column" fxLayoutAlign="start" fxFlex="1 0 auto">
                                        <div fxLayout="row" fxLayoutAlign="start center" fxFlex="1 0 auto">
                                            <span fxFlex="100">Координаты</span>
                                        </div>

                                        <div fxLayout="row" fxLayoutAlign="start center" fxFlex="1 0 auto">
                                            <mat-form-field fxFlex="50" class="pr-4">
                                                <input matInput [(ngModel)]="lat" placeholder="lat"
                                                       [ngModelOptions]="{standalone: true}"
                                                       [required]="records[x].required_boolean">
                                            </mat-form-field>
                                            <mat-form-field fxFlex="50" class="pl-4">
                                                <input matInput [(ngModel)]="lng" placeholder="lng"
                                                       [ngModelOptions]="{standalone: true}"
                                                       [required]="records[x].required_boolean">
                                            </mat-form-field>
                                        </div>
                                        <div fxLayout="row" fxLayoutAlign="start center" fxFlex="1 0 auto">
                                            <mat-form-field fxFlex="100">
                                                <agm-map [latitude]="lat_center" [longitude]="lng_center"
                                                         (mapClick)="mapClick($event)">
                                                    <ng-container *ngIf="lat != '' && lng != ''">
                                                        <agm-marker [latitude]="lat" [longitude]="lng"></agm-marker>
                                                    </ng-container>
                                                </agm-map>

                                                <input formControlName="{{records[x].name}}" matInput [hidden]="true">
                                                <mat-error>{{records[x].title}} обязательное поле!</mat-error>
                                            </mat-form-field>

                                        </div>

                                    </div>



                                </span>

                                <mat-form-field [hidden]="records[x].hidden" *ngSwitchCase="'textarea'">
                                    <textarea matInput matTextareaAutosize formControlName="{{records[x].name}}"
                                              [required]="records[x].required_boolean"
                                              placeholder="{{records[x].title}}"></textarea>
                                    <mat-error>{{records[x].title}} обязательное поле!</mat-error>
                                </mat-form-field>

                                <mat-form-field [hidden]="records[x].hidden" *ngSwitchCase="'password'">
                                    <input matInput type="password" formControlName="{{records[x].name}}"
                                           [required]="records[x].required_boolean" placeholder="{{records[x].title}}">
                                    <mat-error>{{records[x].title}} обязательное поле!</mat-error>
                                </mat-form-field>

                                <mat-form-field [hidden]="records[x].hidden" *ngSwitchDefault>
                                    <input matInput formControlName="{{records[x].name}}"
                                           [required]="records[x].required_boolean" placeholder="{{records[x].title}}">
                                    <mat-error>{{records[x].title}} обязательное поле!</mat-error>
                                </mat-form-field>
                            </span>

                        </span>
                        </mat-tab>

                    </mat-tab-group>

                </div>

            </form>
        </div>
        <div fxFlex="50">
            <profile-timeline></profile-timeline>
        </div>
    </div>

</div>